<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Implementation of Deep Learning Algorithm for Solar Forecasting on Cloud/IoT Platform: Thesis Project</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Implementation of Deep Learning Algorithm for Solar Forecasting on Cloud/IoT Platform
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Thesis Project </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><blockquote class="doxtable">
<p >&zwj;Implementation of Deep Learning Algorithm for Solar Forecasting on Cloud/IoT Platform. </p>
</blockquote>
<h1><a class="anchor" id="autotoc_md1"></a>
Table of Contents</h1>
<ul>
<li>[](#)<ul>
<li>Table of Contents</li>
<li>General Information</li>
<li>Features</li>
<li>Setup Raspberry Pi Environment</li>
<li>Setup Windows or Linux Environment</li>
<li>Obtain API keys<ul>
<li>OpenWeather API key</li>
<li>Google Sheets API key</li>
</ul>
</li>
<li>Usage</li>
<li>Project Status</li>
<li>Room for Improvement</li>
<li>Acknowledgements</li>
<li>Contact</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md2"></a>
General Information</h1>
<ul>
<li>Solar power forecasting pipeline (Data acquisition, processing, forecasting and publishing).</li>
<li>Training an LSTM model for solar power forecasting, (training is not performed on Raspberry Pi).</li>
<li>LSTM model is used to predict the solar power output for the next 24 hours.</li>
<li>Predictions are uploaded to cloud (Google sheets).</li>
<li>The project is hosted on a Raspberry Pi model 3b</li>
</ul>
<h1><a class="anchor" id="autotoc_md3"></a>
Setup Windows or Linux Environment</h1>
<p >To set up on Windows or Linux machine, in case of additionally training the model.</p><ul>
<li>Create a python virtual environment.</li>
<li>install requirements <code>pip install -r requirements.txt</code>.</li>
</ul>
<h1><a class="anchor" id="autotoc_md4"></a>
Setup Raspberry Pi Environment</h1>
<p >It is recommended to install the specified versions, for compatibility reasons with RPi's cpu ARM architecture.</p>
<h2><a class="anchor" id="autotoc_md5"></a>
1. Install recommended OS, python and Tensorflow versions</h2>
<ul>
<li>Raspberry pi OS.<ul>
<li><b>Debian version: 10 (buster)</b> : <a href="https://downloads.raspberrypi.org/raspios_lite_armhf/images/raspios_lite_armhf-2021-01-12/">https://downloads.raspberrypi.org/raspios_lite_armhf/images/raspios_lite_armhf-2021-01-12/</a>.</li>
</ul>
</li>
<li>python 3.7.3 (By default included in Debian 10 (buster)).</li>
<li>Tensorflow - 2.4.0: <a href="https://github.com/lhelontra/tensorflow-on-arm/releases">https://github.com/lhelontra/tensorflow-on-arm/releases</a>.</li>
</ul>
<h2><a class="anchor" id="autotoc_md6"></a>
2. Install required libraries specified in requirements.txt file:</h2>
<div class="fragment"><div class="line">pip install -r requirements.txt</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md7"></a>
2.1 - If numpy installation error occurs follow this steps:</h2>
<div class="fragment"><div class="line">sudo apt-get update\</div>
<div class="line">pip install cython</div>
<div class="line">sudo apt-get install gcc python3.7-dev</div>
<div class="line">pip install pycocotools==2.0.0</div>
<div class="line">pip install --upgrade numpy==1.20.1</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md8"></a>
2.2 - Same if h5py installation error occurs:</h2>
<div class="fragment"><div class="line">pip uninstall h5py\</div>
<div class="line">sudo apt-get install libhdf5-dev\</div>
<div class="line">pip install h5py</div>
<div class="line">pip install --upgrade h5py==2.10.0</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md9"></a>
3. Modify Tensorflow function</h2>
<p >To overcome this issue: <a href="https://github.com/tensorflow/models/issues/9706">https://github.com/tensorflow/models/issues/9706</a>.</p>
<p >by following glemarivero's suggestion:\ modify **_constant_if_small(value, shape, dtype, name)** function:</p>
<div class="fragment"><div class="line">sudo vim /home/pi/tensorflow/lib/python3.7/site-packages/tensorflow/python/ops/array_ops.py</div>
</div><!-- fragment --><p> replace <code>np.prod(shape)</code> with <code>reduce_prod(shape)</code>, and \ import <code>from tensorflow.math import reduce_prod</code> : the modified code should look like this:</p>
<div class="fragment"><div class="line"><span class="keyword">from</span> tensorflow.math <span class="keyword">import</span> reduce_prod <span class="comment"># we import this on top of the file</span></div>
<div class="line"><span class="keyword">def </span>_constant_if_small(value, shape, dtype, name):\</div>
<div class="line">  <span class="keywordflow">try</span>:\</div>
<div class="line">    <span class="keywordflow">if</span> np.prod(shape) &lt; 1000: </div>
<div class="line">      <span class="keywordflow">return</span> constant(value, shape=shape, dtype=dtype, name=name)\</div>
<div class="line">  <span class="keywordflow">except</span> TypeError:\</div>
<div class="line">    <span class="comment"># Happens when shape is a Tensor, list with Tensor elements, etc.\</span></div>
<div class="line">    <span class="keywordflow">pass</span>\</div>
<div class="line">  <span class="keywordflow">return</span> <span class="keywordtype">None</span></div>
</div><!-- fragment --> <h1><a class="anchor" id="autotoc_md10"></a>
Obtain API keys</h1>
<p >This project uses the below API's:</p><ul>
<li><a href="https://openweathermap.org/">https://openweathermap.org/</a> - to obtain weather data.</li>
<li><a href="https://console.cloud.google.com/">https://console.cloud.google.com/</a> - Google Sheets where the forecasted data will be uploaded and displayed.</li>
</ul>
<h2><a class="anchor" id="autotoc_md11"></a>
1. OpenWeather API key</h2>
<ol type="1">
<li>Go to <a href="https://home.openweathermap.org/api_keys">https://home.openweathermap.org/api_keys</a>.</li>
</ol>
<ol type="1">
<li><code>Create key</code> -&gt; insert the key name and press <code>Generate</code>.</li>
<li>Copy the generated key and add it on the existing <a href="https://github.com/BasianLesi/solar-power-forecasting-thesis-project/blob/master/config/OpenWeather_API_settings.json#:~:text=%7B-,%22api_key%22%3A%20%22%22,-%2C%20%22lat%22">OpenWeather_API_settings.json</a> file. <br  />
</li>
<li>The final file file should looks like below:</li>
</ol>
<div class="fragment"><div class="line">{&quot;api_key&quot;: &quot;xxxxxxxxxxxxxxx&quot;, &quot;lat&quot;: &quot;55.1449&quot;, &quot;lon&quot;: &quot;14.9170&quot;}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md12"></a>
2. Google Sheets API key</h2>
<p >The aim is to create API keys for Google Sheets access and obtain credentials creds.json file similar to below: </p><div class="fragment"><div class="line">{</div>
<div class="line">    &quot;type&quot;: &quot;service_account&quot;,</div>
<div class="line">    &quot;project_id&quot;: &quot;testsheets-xxxxxx&quot;,</div>
<div class="line">    &quot;private_key_id&quot;: &quot;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&quot;,</div>
<div class="line">    &quot;private_key&quot;: &quot;-----BEGIN PRIVATE KEY-----\nxxxxxxxxxxxxxxxxxxxxxxx\n-----END PRIVATE KEY-----\n&quot;,</div>
<div class="line">    &quot;client_email&quot;: &quot;example@testsheets-xxxxx.iam.gserviceaccount.com&quot;,</div>
<div class="line">    &quot;client_id&quot;: &quot;xxxxxxxxxxxx&quot;,</div>
<div class="line">    &quot;auth_uri&quot;: &quot;https://accounts.google.com/o/oauth2/auth&quot;,</div>
<div class="line">    &quot;token_uri&quot;: &quot;https://oauth2.googleapis.com/token&quot;,</div>
<div class="line">    &quot;auth_provider_x509_cert_url&quot;: &quot;https://www.googleapis.com/oauth2/v1/certs&quot;,</div>
<div class="line">    &quot;client_x509_cert_url&quot;: &quot;https://www.googleapis.com/robot/v1/metadata/x509/example%40testsheets-xxxxxx.iam.gserviceaccount.com&quot;</div>
<div class="line">  }</div>
</div><!-- fragment --><ol type="1">
<li>Go to <a href="https://console.cloud.google.com/">https://console.cloud.google.com/</a> Dashboard and CREATE PROJECT (follow the set up steps).</li>
</ol>
<ol type="1">
<li>Navigation <code>button</code> -&gt; <code>APIs &amp; Services</code> -&gt; <code>ENABLE APIS AND SERVICES</code>.</li>
</ol>
<ol type="1">
<li>Select <code>Google Sheets API</code> -&gt; <code>ENABLE</code>.</li>
</ol>
<ol type="1">
<li>Go to Credentials tab -&gt; <code>CREATE CREDENTIALS</code> -&gt; <code>Service account</code> (follow the set up steps).</li>
</ol>
<ol type="1">
<li>On Credentials tab -&gt; click the email on Service Accounts section <code>example@testsheets-xxxxx.iam.gserviceaccount.com</code>.</li>
</ol>
<ol type="1">
<li>On Keys section click <code>ADD KEY</code> -&gt; <code>Create new key</code> -&gt; <code>JSON</code> -&gt; <code>creds.json</code> file will be downloaded (rename to creds.json if necessary).</li>
</ol>
<ol type="1">
<li>Create a new Google spreadsheet <a href="https://docs.google.com/spreadsheets/">https://docs.google.com/spreadsheets/</a>.</li>
</ol>
<ol type="1">
<li>On the created spreadsheet page click <code>Share</code> -&gt; add <code>example@testsheets-xxxxx.iam.gserviceaccount.com</code> (with editor option) -&gt; and press <code>Share</code>.</li>
</ol>
<ol type="1">
<li>Add creds.json file to the project <a href="https://github.com/BasianLesi/solar-power-forecasting-thesis-project/tree/master/config">./config/</a> directory.</li>
</ol>
<h1><a class="anchor" id="autotoc_md13"></a>
Usage</h1>
<p >After successfully completing the above steps, to start the pipeline run:</p>
<p ><code>python ./src/main.py</code></p>
<p >Now the pipeline should be up and running. It should now successfully make solar power generation forecasting for the next 24 hours and upload to cloud. The forecasting is updated hourly.</p>
<h3><a class="anchor" id="autotoc_md14"></a>
Additional settings</h3>
<p >In <a href="https://github.com/BasianLesi/solar-power-forecasting-thesis-project/blob/master/src/config.py#:~:text=DEBUG%20%3D%20True,to%20save%20figures">src/config.py</a> file we can modify the settings below: </p><div class="fragment"><div class="line">DEBUG = <span class="keyword">False</span> <span class="comment"># Set True to print debug messages</span></div>
<div class="line">VISUAL = <span class="keyword">False</span> <span class="comment"># Set True to plot</span></div>
<div class="line">TUNING = <span class="keyword">False</span> <span class="comment"># Set True to for hyperparameter tuning using bayesian optimization            </span></div>
<div class="line">SAVE_FIGURES = <span class="keyword">False</span> <span class="comment"># Set True to save figures</span></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md15"></a>
Project Status</h1>
<p ><em>in progress</em></p>
<h1><a class="anchor" id="autotoc_md16"></a>
Room for Improvement</h1>
<ul>
<li>Develop a robust reliable source for fetching Solar and Wind power generated data for bornholm area past input in the model:</li>
<li>Improve Wind power model by adding additional features weather features (wind direction)</li>
</ul>
<h1><a class="anchor" id="autotoc_md17"></a>
Contact</h1>
<p >Created by <a href="basian.lesi@gmai.com">@BasianLesi</a> - feel free to contact me! </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4
</small></address>
</body>
</html>
